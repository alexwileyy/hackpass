<html>
    <head>
        <link rel="stylesheet" type="text/css" href="/style/css/organiser.css"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    </head>
    <body>
        <section id="logo">
            <img src="/images/logo.svg"/>
        </section>
        <section id="users">
            <div class="panel-header">
                <h2><span id="hackathon-name"></span>, Organiser Panel</h2>
                <hr>
            </div>
            <div class="panel-content">
                <img src="/images/mail.svg"/>
                <h3>Message a user</h3>
                <div id="user-list">
                </div>
            </div>
        </section>

        <script>
            //Get event title

            function getQueryVariable(variable) {
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i=0;i<vars.length;i++) {
                    var pair = vars[i].split("=");
                    if(pair[0] == variable){
                        return string = pair[1];

                    }
                }
                return(false);
            }

            var eventId = getQueryVariable('event_id');
            console.log(eventId);

            $.ajax({
                type: 'post',
                url: 'http://localhost:9001/event/attendees',
                data: {
                    eventID: getQueryVariable('event_id')
                },
                xhrFields: {
                    withCredentials: false
                },
                success: function (data) {
                    console.log('Success');
                    console.log(data);
                    addData(data);
                },
                error: function () {
                    console.log('We are sorry but our servers are having an issue right now');
                }
            })

            function addData(data){
                //Add page name
                $('#hackathon-name').html(data.eventName);
                //Add users
                console.log(data);
                const attendee = data.attendees;
                const userList = document.getElementById('user-list');
                console.log('Attendee: ' + attendee);
                attendee.forEach(processMembers);

                function processMembers(item, i, array) {
                    const userItem = document.createElement("DIV");
                    userItem.className += 'user-item';
                    const userLeft = document.createElement("DIV");
                    userLeft.className += 'user-left';
                    const userRight = document.createElement("DIV");
                    userRight.className += 'user-right';
                    userItem.appendChild(userLeft);
                    userItem.appendChild(userRight);
                    const name = document.createElement("H3");
                    name.innerText = array[i].first_name;
                    const userRightLink = document.createElement("A");
                    userRightLink.href = '/call/' + data._id;
                    const button = document.createElement("BUTTON");
                    button.innerText = 'Message';
                    userRightLink.appendChild(button);
                    userLeft.appendChild(name);
                    userRight.appendChild(userRightLink);
                    console.log(userItem);
                    userList.appendChild(userItem);
                }

            }

            test();
        </script>
    </body>
</html>